package xyz.sethy.cd.task;

import net.minecraft.client.Minecraft;
import net.minecraft.client.entity.EntityClientPlayerMP;
import net.minecraft.entity.player.EntityPlayer;
import xyz.sethy.cd.extended.ExtendedPlayer;

public class CheckPlayerLocationTask implements Runnable {
	private final float waterLossPerBlock = 0.3f;
	
	private int lastX = 0;
	private int lastZ = 0;
	
	@Override
	public void run() {
		Minecraft.getMinecraft().getLogAgent().logInfo("");
		
		EntityPlayer player = (EntityPlayer) Minecraft.getMinecraft().thePlayer;
	
		int x = player.getPlayerCoordinates().posX;
		int z = player.getPlayerCoordinates().posZ;
		
		if (lastX == x || lastZ == z)
			return;
		
		int movedX = Math.abs(lastX - x);
		int movedZ = Math.abs(lastZ - z);
		
		int movedTotal = movedX + movedZ;

		float waterUsed = movedTotal * waterLossPerBlock;
		
		ExtendedPlayer extendedPlayer = ExtendedPlayer.get(player);
		extendedPlayer.useWater(waterUsed);
		
		lastZ = z;
		lastX = x;
		
		Minecraft.getMinecraft().getLogAgent().logInfo(String.format("Player just lost %s water after travelling %s blocked, this leaves them with %s water", waterUsed, movedTotal, extendedPlayer.getCurrentWaterLevel()));
	}
}
